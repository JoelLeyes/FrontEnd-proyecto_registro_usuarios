<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Usuario</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
    <div class="container">
        <h1>Registro de Usuario</h1>
        <form id="registroForm">
            <label for="nombre">Nombre:</label>
            <input type="text" id="nombre" name="nombre" required>

            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required>

            <label for="telefono">Teléfono:</label>
            <input type="tel" id="telefono" name="telefono" required>

            <button type="submit">Registrar</button>
        </form>

        <div id="mensaje" style="margin-top:15px; font-weight:bold;"></div>

        <a href="index.html" style="display:block; margin-top:15px;">Volver al Inicio</a>
    </div>

    <script>
    // Detecta automáticamente la URL del API según el entorno
    const API_BASE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
      ? 'http://localhost:8000/api'
      : `${window.location.protocol}//${window.location.host}/api`;

    document.getElementById("registroForm").addEventListener("submit", async function (event) {
        event.preventDefault();

        const nombre = document.getElementById("nombre").value;
        const email = document.getElementById("email").value;
        const telefono = document.getElementById("telefono").value;

        const datosUsuario = {
            nombre: nombre,
            email: email,
            telefono: telefono
        };

        try {
            const respuesta = await axios.post(`${API_BASE}/usuarios/`, datosUsuario);
            document.getElementById("mensaje").innerHTML = "✅ Usuario registrado correctamente. Revisá tu correo.";
            document.getElementById("mensaje").style.color = "green";
            document.getElementById("registroForm").reset();
        } catch (error) {
            console.error("❌ Error al registrar:", error);
            document.getElementById("mensaje").innerHTML = "⚠️ Error al registrar el usuario: " + (error.response?.data?.detail || error.message);
            document.getElementById("mensaje").style.color = "red";
        }
    });
    </script>
</body>
</html>
